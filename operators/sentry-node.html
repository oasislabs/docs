<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sentry Node Architecture | Oasis Dev Docs</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-116576458-1"></script>
    <script>window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'UA-116576458-1');</script>
    <meta name="description" content="Oasis Developer Documentation">
    <link rel="preload" href="/assets/css/0.styles.5adf1fa7.css" as="style"><link rel="preload" href="/assets/js/app.910bcae1.js" as="script"><link rel="preload" href="/assets/js/2.7de60783.js" as="script"><link rel="preload" href="/assets/js/23.0e43b5ab.js" as="script"><link rel="prefetch" href="/assets/js/10.af50cd7e.js"><link rel="prefetch" href="/assets/js/11.d9e34cb5.js"><link rel="prefetch" href="/assets/js/12.25bd64b3.js"><link rel="prefetch" href="/assets/js/13.08c5d301.js"><link rel="prefetch" href="/assets/js/14.62f4ceb3.js"><link rel="prefetch" href="/assets/js/15.e15506f8.js"><link rel="prefetch" href="/assets/js/16.36670149.js"><link rel="prefetch" href="/assets/js/17.78375f35.js"><link rel="prefetch" href="/assets/js/18.361a9499.js"><link rel="prefetch" href="/assets/js/19.6b6aaca8.js"><link rel="prefetch" href="/assets/js/20.c48732db.js"><link rel="prefetch" href="/assets/js/21.a20d3da8.js"><link rel="prefetch" href="/assets/js/22.fa33644a.js"><link rel="prefetch" href="/assets/js/24.5c8a0a47.js"><link rel="prefetch" href="/assets/js/25.622c1ff6.js"><link rel="prefetch" href="/assets/js/26.1272b3f4.js"><link rel="prefetch" href="/assets/js/27.fe5c1b5c.js"><link rel="prefetch" href="/assets/js/3.0c85dcbf.js"><link rel="prefetch" href="/assets/js/4.06c38ad3.js"><link rel="prefetch" href="/assets/js/5.146cff05.js"><link rel="prefetch" href="/assets/js/6.68976ca4.js"><link rel="prefetch" href="/assets/js/7.10b76604.js"><link rel="prefetch" href="/assets/js/8.1930400d.js"><link rel="prefetch" href="/assets/js/9.189c5e78.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5adf1fa7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Oasis Dev Docs" class="logo"> <span class="site-name can-hide">Oasis Dev Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://oasisprotocol.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://oasisprotocol.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/overview.html" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Operator Docs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operators/overview.html" class="sidebar-link">Node Operator Overview</a></li><li><a href="/operators/architecture-overview.html" class="sidebar-link">Network Architecture Overview</a></li><li><a href="/operators/prerequisites.html" class="sidebar-link">Prerequisites Guide</a></li><li><a href="/operators/amber-network.html" class="sidebar-link">Amber Network</a></li><li><a href="/operators/community-node.html" class="sidebar-link">Community Node Program</a></li><li><a href="/operators/hardware-recommendations.html" class="sidebar-link">Node Hardware Recommendations</a></li><li><a href="/operators/running-node-on-amber-network.html" class="sidebar-link">Running a Node on the Amber Network</a></li><li><a href="/operators/creating-an-entity-package.html" class="sidebar-link">Creating an Entity Package</a></li><li><a href="/operators/migrating-questnet-entities.html" class="sidebar-link">Migrating Your QuestNet Entity for the Amber Network</a></li><li><a href="/operators/current-testnet-parameters.html" class="sidebar-link">Current Testnet Parameters</a></li><li><a href="/operators/stake-management.html" class="sidebar-link">Stake Management</a></li><li><a href="/operators/sentry-node.html" aria-current="page" class="active sidebar-link">Sentry Node Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operators/sentry-node.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/operators/sentry-node.html#configuring-the-oasis-sentry-node" class="sidebar-link">Configuring the Oasis Sentry Node</a></li><li class="sidebar-sub-header"><a href="/operators/sentry-node.html#configuring-the-oasis-validator-node" class="sidebar-link">Configuring the Oasis Validator Node</a></li></ul></li><li><a href="/operators/incentives-proposal.html" class="sidebar-link">Network Incentives Proposal</a></li><li><a href="/operators/the-quest-rules.html" class="sidebar-link">The Quest Rules</a></li><li><a href="/operators/troubleshooting.html" class="sidebar-link">Troubleshooting Guide</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Maintenance Guides</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wallet Support</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/operators/community-resources.html" class="sidebar-link">Community Tools</a></li><li><a href="https://github.com/oasisprotocol/oasis-core/blob/master/docs/index.md" target="_blank" rel="noopener noreferrer" class="sidebar-link">Oasis Core Developer Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sentry-node-architecture"><a href="#sentry-node-architecture" class="header-anchor">#</a> Sentry Node Architecture</h1> <p>This guide provides instructions for a deployment using the Sentry node
architecture to protect validator nodes from being directly exposed on the
public network.</p> <p>This guide assumes a setup where an Oasis validator node is only accessible
over a private network, with sentry nodes having access to it.
The guide does not cover setting this infrastructure up.
Knowledge of <a href="https://forum.cosmos.network/t/sentry-node-architecture-overview/454" target="_blank" rel="noopener noreferrer">Tendermint's Sentry Node architecture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is assumed as
well.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>This is only an example of a Sentry node deployment, and we take no responsibility
for mistakes contained therein.
Make sure you understand what you are doing.</p></div> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Before following this guide, make sure you've read the <a href="/operators/prerequisites.html">Prerequisites</a> and
<a href="/operators/running-node-on-amber-network.html">Running a Node on the Amber Network</a> guides and created your Entity.</p> <h2 id="configuring-the-oasis-sentry-node"><a href="#configuring-the-oasis-sentry-node" class="header-anchor">#</a> Configuring the Oasis Sentry Node</h2> <h3 id="initializing-sentry-node"><a href="#initializing-sentry-node" class="header-anchor">#</a> Initializing Sentry Node</h3> <p>Sentry node identity keys can be initialized with:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node identity init --datadir /serverdir/node
</code></pre></div><p>The generated <code>tls_identity_cert.pem</code> (which is the node's TLS cert for
securing gRPC connections) needs to be available on any node that will be
protected by the sentry node.</p> <h3 id="configuring-sentry-node"><a href="#configuring-sentry-node" class="header-anchor">#</a> Configuring Sentry Node</h3> <p>An Oasis node can be configured to run as a sentry node by setting the
<code>worker.sentry.enabled</code> flag. The <code>tendermint.sentry.upstream_address</code>
flag can be used to configure a list of nodes that will be protected by the
sentry node.</p> <p>An example of full <code>YAML</code> configuration of a sentry node is below.</p> <p>Before using this configuration you should collect the following information to
replace the <code>{{ var_name }}</code> variables present in the
configuration file:</p> <ul><li><p><code>{{ external_address }}</code>: This is the external IP on which
sentry node will be reachable.</p></li> <li><p><code>{{ seed_node_address }}</code>: This the seed node address of the
form <code>ID@IP:port</code>. You can find the current Oasis Seed Node address in the
<a href="/operators/current-testnet-parameters.html">Current Testnet Parameters</a>.</p></li> <li><p><code>{{ validator_tendermint_id }}</code>: This is the Tendermint ID
(address) of the Oasis validator node that will be protected by the sentry
node. This ID can be obtained by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node identity tendermint show-node-address --datadir /serverdir/node
</code></pre></div><p>on the validator node.</p></li> <li><p><code>{{ validator_private_address }}</code>: This is the (presumably)
private address on which validator should be reachable from the sentry node.</p></li> <li><p><code>{{ validator_sentry_client_grpc_public_key }}</code>: This is the
public TLS key of the Oasis validator node that will be protected by the
sentry node. This public key can be obtained by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code> oasis-node identity show-sentry-client-pubkey --datadir /serverdir/node
</code></pre></div><p>on the validator node. Note that the above command is only available in
<code>oasis-node</code> from version 20.8.1 onward.</p></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">##</span>
<span class="token comment"># Oasis Sentry Node Configuration</span>
<span class="token comment">#</span>
<span class="token comment"># This file's configurations are derived from the command line args found in the</span>
<span class="token comment"># root command of the oasis-node binary. For more information execute:</span>
<span class="token comment">#</span>
<span class="token comment">#     oasis-node --help</span>
<span class="token comment">#</span>
<span class="token comment"># Settings on the command line that are separated by a dot all belong to the</span>
<span class="token comment"># same nested object. So &quot;--foo.bar.baz hello&quot; would translate to:</span>
<span class="token comment">#</span>
<span class="token comment">#     foo:</span>
<span class="token comment">#       bar:</span>
<span class="token comment">#         baz: hello</span>
<span class="token comment">##</span>

<span class="token comment"># Set this to where you wish to store node data. The node artifacts</span>
<span class="token comment"># should also be located in this directory (for us this is /serverdir/node)</span>
<span class="token key atrule">datadir</span><span class="token punctuation">:</span> /serverdir/node

<span class="token comment"># Logging.</span>
<span class="token comment">#</span>
<span class="token comment"># Per-module log levels are defined below. If you prefer just one unified log</span>
<span class="token comment"># level, you can use:</span>
<span class="token comment">#</span>
<span class="token comment"># log:</span>
<span class="token comment">#   level: debug</span>
<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token comment"># Per-module log levels. Longest prefix match will be taken. Fallback to</span>
    <span class="token comment"># &quot;default&quot;, if no match.</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">tendermint</span><span class="token punctuation">:</span> warn
    <span class="token key atrule">tendermint/context</span><span class="token punctuation">:</span> error
  <span class="token key atrule">format</span><span class="token punctuation">:</span> JSON
  <span class="token comment"># By default logs are output to stdout. If you're running this in docker keep</span>
  <span class="token comment"># the default</span>
  <span class="token comment">#file: /var/log/oasis-node.log</span>

<span class="token comment"># Path to the genesis file for the current version of the network.</span>
<span class="token key atrule">genesis</span><span class="token punctuation">:</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span> /serverdir/etc/genesis.json

<span class="token comment"># Worker configuration.</span>
<span class="token key atrule">worker</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentry</span><span class="token punctuation">:</span>
    <span class="token comment"># Enable sentry node.</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># Port used by validator nodes to query sentry node for registry</span>
    <span class="token comment"># information.</span>
    <span class="token comment"># IMPORTANT: Only validator nodes protected by the sentry node should have</span>
    <span class="token comment"># access to this port. This port should not be exposed on the public</span>
    <span class="token comment"># network.</span>
    <span class="token key atrule">control</span><span class="token punctuation">:</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9009</span>
      <span class="token key atrule">authorized_pubkey</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> validator_sentry_client_grpc_public_key <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment"># Tendermint backend configuration.</span>
<span class="token key atrule">tendermint</span><span class="token punctuation">:</span>
  <span class="token key atrule">abci</span><span class="token punctuation">:</span>
    <span class="token key atrule">prune</span><span class="token punctuation">:</span>
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span> keep_n
      <span class="token comment"># Keep ~1 hour of data since block production is ~1 block every 6 seconds.</span>
      <span class="token comment"># (3600/6 = 600)</span>
      <span class="token key atrule">num_kept</span><span class="token punctuation">:</span> <span class="token number">600</span>
  <span class="token key atrule">core</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen_address</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">26656</span>
    <span class="token key atrule">external_address</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//<span class="token punctuation">{</span><span class="token punctuation">{</span> external_address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">:</span><span class="token number">26656</span>

  <span class="token comment"># List of seed nodes to connect to.</span>
  <span class="token comment"># NOTE: You can add additional seed nodes to this list if you want.</span>
  <span class="token key atrule">p2p</span><span class="token punctuation">:</span>
    <span class="token key atrule">seed</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;{{ seed_node_address }}&quot;</span>

  <span class="token key atrule">sentry</span><span class="token punctuation">:</span>
    <span class="token key atrule">upstream_address</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;{{ validator_tendermint_id }}@{{ validator_private_address }}:26656&quot;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Multiple sentry nodes can be provisioned following the above steps.</p></div> <h2 id="configuring-the-oasis-validator-node"><a href="#configuring-the-oasis-validator-node" class="header-anchor">#</a> Configuring the Oasis Validator Node</h2> <p>In this setup the Oasis validator node should not be exposed directly on the
public network. The Oasis validator only needs to be able to connect to its
sentry nodes, preferably via a private network.</p> <h3 id="initializing-validator-node"><a href="#initializing-validator-node" class="header-anchor">#</a> Initializing Validator Node</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If your validator node is already registered and running in a non-sentry setup,
this step can be skipped as the Oasis validator will update its address in the
Registry automatically once we redeploy it with new configuration.</p></div> <p>When you are <a href="/operators/running-node-on-amber-network.html#initializing-a-node">initializing a validator node</a>, you should use the
sentry node's external address and Consensus ID in the
<code>node.consensus_address</code> flag.
If you are running multiple sentry nodes, you can specify the
<code>node.consensus_address</code> flag multiple times.</p> <p>To initialize a validator node with 2 sentry nodes, run the
following commands from the <code>/localhostdir/node</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">SENTRY1_CONSENSUS_ID</span><span class="token operator">=</span><span class="token operator">&lt;</span>YOUR_SENTRY1_CONSENSUS_ID_B6<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SENTRY1_STATIC_IP</span><span class="token operator">=</span><span class="token operator">&lt;</span>YOUR_SENTRY1_STATIC_IP<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SENTRY2_CONSENSUS_ID</span><span class="token operator">=</span><span class="token operator">&lt;</span>YOUR_SENTRY2_CONSENSUS_ID_B6<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SENTRY2_STATIC_IP</span><span class="token operator">=</span><span class="token operator">&lt;</span>YOUR_SENTRY2_STATIC_IP<span class="token operator">&gt;</span>
oasis-node registry node init <span class="token punctuation">\</span>
  --signer.backend <span class="token function">file</span> <span class="token punctuation">\</span>
  --signer.dir /localhostdir/entity <span class="token punctuation">\</span>
  --node.consensus_address <span class="token variable">$SENTRY1_CONSENSUS_ID</span>@<span class="token variable">$SENTRY1_STATIC_IP</span>:26656 <span class="token punctuation">\</span>
  --node.consensus_address <span class="token variable">$SENTRY2_CONSENSUS_ID</span>@<span class="token variable">$SENTRY2_STATIC_IP</span>:26656 <span class="token punctuation">\</span>
  --node.is_self_signed <span class="token punctuation">\</span>
  --node.role validator
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p><code>SENTRY_CONSENSUS_ID</code>: This is the Consensus ID of the sentry node in base64
format.
This ID can be obtained from <code>consensus_pub.pem</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sed</span> -n 2p /serverdir/node/consensus_pub.pem
</code></pre></div><p>on the sentry node.</p></div> <h3 id="configuring-validator-node"><a href="#configuring-validator-node" class="header-anchor">#</a> Configuring Validator Node</h3> <p>There are some configuration changes needed for the Oasis validator node to
enable proxying through its sentry node. Most of these flags should be familiar
from the Tendermint sentry node architecture.</p> <p>Since the validator node will not have an external address, the
<code>tendermint.core.external_address</code> flag should be skipped. Similarly, the
<code>tendermint.p2p.seed</code> flag can be skipped, as the <code>oasis-node</code> won't be directly
connecting to any of the seed nodes.</p> <p>Tendermint Peer Exchange should be disabled on the validator with the
<code>tendermint.p2p.disable_peer_exchange</code> flag.</p> <p>Sentry nodes can also be configured as Tendermint Persistent-Peers with the
<code>tendermint.p2p.persistent_peer</code> flag.</p> <p>In addition to the familiar Tendermint setup above, the node needs to be
configured to query sentry nodes for external addresses every time the validator
preforms a re-registration. This is configured with the <code>worker.sentry.address</code>
flag.</p> <p>The <code>worker.sentry.address</code> flag is of format: <code>&lt;pubkey&gt;@ip:port</code>
where:</p> <ul><li><code>&lt;pubkey&gt;</code>: Is the sentry node's TLS public key.</li> <li><code>ip:port</code>: Is the (private) address of the sentry node's control endpoint.</li></ul> <p>Putting it all together, an example configuration of a validator node in the
sentry node architecture is given below.</p> <p>Before using this configuration you should collect the following information to
replace the <code>{{ var_name }}</code> variables present in the configuration
file:</p> <ul><li><p><code>{{ sentry_node_private_ip }}</code>: This is the private IP
address of the sentry node over which sentry node should be accessible to the
validator.</p></li> <li><p><code>{{ sentry_node_grpc_public_key }}</code>: This is the sentry
node's control endpoint TLS public key. This ID can be obtained by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node identity show-tls-pubkey --datadir /serverdir/node
</code></pre></div><p>on the sentry node. Note that the above command is only available in
<code>oasis-node</code> from version 20.8.1 onward.</p></li> <li><p><code>{{ sentry_node_tendermint_id }}</code>: This is the Tendermint ID
(address) of the sentry node that will be configured as a Persistent Peer.
This ID can be obtained by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node identity tendermint show-node-address --datadir /serverdir/node
</code></pre></div><p>on the sentry node.</p></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">##</span>
<span class="token comment"># Oasis Node Configuration</span>
<span class="token comment">#</span>
<span class="token comment"># This file's configurations are derived from the command line args found in</span>
<span class="token comment"># the root command of the oasis-node binary. For more information execute:</span>
<span class="token comment">#</span>
<span class="token comment">#     oasis-node --help</span>
<span class="token comment">#</span>
<span class="token comment"># Settings on the command line that are separated by a dot all belong to the</span>
<span class="token comment"># same nested object. So &quot;--foo.bar.baz hello&quot; would translate to:</span>
<span class="token comment">#</span>
<span class="token comment">#     foo:</span>
<span class="token comment">#       bar:</span>
<span class="token comment">#         baz: hello</span>
<span class="token comment">##</span>

<span class="token comment"># Set this to where you wish to store node data. The node artifacts</span>
<span class="token comment"># should also be located in this directory (for us this is /serverdir/node)</span>
<span class="token key atrule">datadir</span><span class="token punctuation">:</span> /serverdir/node

<span class="token comment"># Logging.</span>
<span class="token comment">#</span>
<span class="token comment"># Per-module log levels are defined below. If you prefer just one unified log</span>
<span class="token comment"># level, you can use:</span>
<span class="token comment">#</span>
<span class="token comment"># log:</span>
<span class="token comment">#   level: debug</span>
<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token comment"># Per-module log levels. Longest prefix match will be taken. Fallback to</span>
    <span class="token comment"># &quot;default&quot;, if no match.</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">tendermint</span><span class="token punctuation">:</span> warn
    <span class="token key atrule">tendermint/context</span><span class="token punctuation">:</span> error
  <span class="token key atrule">format</span><span class="token punctuation">:</span> JSON
  <span class="token comment"># By default logs are output to stdout. If you're running this in docker keep</span>
  <span class="token comment"># the default</span>
  <span class="token comment">#file: /var/log/oasis-node.log</span>

<span class="token comment"># Path to the genesis file for the current version of the network.</span>
<span class="token key atrule">genesis</span><span class="token punctuation">:</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span> /serverdir/etc/genesis.json

<span class="token comment"># Worker configuration.</span>
<span class="token key atrule">worker</span><span class="token punctuation">:</span>
  <span class="token key atrule">registration</span><span class="token punctuation">:</span>
    <span class="token comment"># In order for the node to register itself the entity.json of the entity</span>
    <span class="token comment"># used to provision the node must be available on the node.</span>
    <span class="token key atrule">entity</span><span class="token punctuation">:</span> /serverdir/node/entity/entity.json
  <span class="token key atrule">sentry</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;{{ sentry_node_grpc_public_key }}@{{ sentry_node_private_ip }}:9009&quot;</span>

<span class="token comment"># Consensus backend.</span>
<span class="token key atrule">consensus</span><span class="token punctuation">:</span>
  <span class="token comment"># Setting this to true will mean that the node you're deploying will attempt</span>
  <span class="token comment"># to register as a validator.</span>
  <span class="token key atrule">validator</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>

<span class="token comment"># Tendermint backend configuration.</span>
<span class="token key atrule">tendermint</span><span class="token punctuation">:</span>
  <span class="token key atrule">abci</span><span class="token punctuation">:</span>
    <span class="token key atrule">prune</span><span class="token punctuation">:</span>
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span> keep_n
      <span class="token comment"># Keep ~7 days of data since block production is ~1 block every 6 seconds.</span>
      <span class="token comment"># (7*24*3600/6 = 100800)</span>
      <span class="token key atrule">num_kept</span><span class="token punctuation">:</span> <span class="token number">100800</span>
  <span class="token key atrule">core</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen_address</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">26656</span>
  <span class="token key atrule">p2p</span><span class="token punctuation">:</span>
    <span class="token key atrule">persistent_peer</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;{{ sentry_node_tendermint_id }}@{{ sentry_node_private_ip }}:26656&quot;</span>
    <span class="token key atrule">disable_peer_exchange</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">backend</span><span class="token punctuation">:</span> badger
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/oasisprotocol/docs/edit/master/src/src/operators/sentry-node.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/operators/stake-management.html" class="prev">
        Stake Management
      </a></span> <span class="next"><a href="/operators/incentives-proposal.html">
        Network Incentives Proposal
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.910bcae1.js" defer></script><script src="/assets/js/2.7de60783.js" defer></script><script src="/assets/js/23.0e43b5ab.js" defer></script>
  </body>
</html>
