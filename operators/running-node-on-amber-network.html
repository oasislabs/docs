<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Running a Node on the Amber Network | Oasis Dev Docs</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/favicon.ico">
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-116576458-1"></script>
    <script>window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'UA-116576458-1');</script>
    <meta name="description" content="Oasis Developer Documentation">
    <link rel="preload" href="/assets/css/0.styles.34665e09.css" as="style"><link rel="preload" href="/assets/js/app.f38c0d12.js" as="script"><link rel="preload" href="/assets/js/2.6394bade.js" as="script"><link rel="preload" href="/assets/js/22.4a8751d6.js" as="script"><link rel="prefetch" href="/assets/js/10.a018c00d.js"><link rel="prefetch" href="/assets/js/11.5514d9bd.js"><link rel="prefetch" href="/assets/js/12.5c7ef14c.js"><link rel="prefetch" href="/assets/js/13.5d65e3e8.js"><link rel="prefetch" href="/assets/js/14.4025194e.js"><link rel="prefetch" href="/assets/js/15.dfcf4130.js"><link rel="prefetch" href="/assets/js/16.67bdccd4.js"><link rel="prefetch" href="/assets/js/17.373a493a.js"><link rel="prefetch" href="/assets/js/18.2626ed5b.js"><link rel="prefetch" href="/assets/js/19.a30d3e84.js"><link rel="prefetch" href="/assets/js/20.9a9a34eb.js"><link rel="prefetch" href="/assets/js/21.656d51e6.js"><link rel="prefetch" href="/assets/js/23.bb4cc5ce.js"><link rel="prefetch" href="/assets/js/24.01977fef.js"><link rel="prefetch" href="/assets/js/25.0df3fa51.js"><link rel="prefetch" href="/assets/js/26.04dad743.js"><link rel="prefetch" href="/assets/js/27.640ef12e.js"><link rel="prefetch" href="/assets/js/3.e3a393df.js"><link rel="prefetch" href="/assets/js/4.65057385.js"><link rel="prefetch" href="/assets/js/5.08967f0c.js"><link rel="prefetch" href="/assets/js/6.329448a1.js"><link rel="prefetch" href="/assets/js/7.07838d0b.js"><link rel="prefetch" href="/assets/js/8.4471cc25.js"><link rel="prefetch" href="/assets/js/9.6a4e3ee6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34665e09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Oasis Dev Docs" class="logo"> <span class="site-name can-hide">Oasis Dev Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://oasisprotocol.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://oasisprotocol.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://join.slack.com/t/oasiscommunity/shared_invite/enQtNjQ5MTA3NTgyOTkzLWIxNTg1ZWZmOTIwNmQ2MTg1YmU0MzgyMzk3OWM2ZWQ4NTQ0ZDJkNTBmMTdlM2JhODllYjg5YmJkODc2NzgwNTg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/overview.html" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Operator Docs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operators/overview.html" class="sidebar-link">Node Operator Overview</a></li><li><a href="/operators/architecture-overview.html" class="sidebar-link">Network Architecture Overview</a></li><li><a href="/operators/prerequisites.html" class="sidebar-link">Prerequisites Guide</a></li><li><a href="/operators/amber-network.html" class="sidebar-link">Amber Network</a></li><li><a href="/operators/community-node.html" class="sidebar-link">Community Node Program</a></li><li><a href="/operators/hardware-recommendations.html" class="sidebar-link">Node Hardware Recommendations</a></li><li><a href="/operators/running-node-on-amber-network.html" aria-current="page" class="active sidebar-link">Running a Node on the Amber Network</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operators/running-node-on-amber-network.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/operators/running-node-on-amber-network.html#creating-your-entity" class="sidebar-link">Creating Your Entity</a></li><li class="sidebar-sub-header"><a href="/operators/running-node-on-amber-network.html#running-an-oasis-node-on-the-server" class="sidebar-link">Running an Oasis Node on the server</a></li><li class="sidebar-sub-header"><a href="/operators/running-node-on-amber-network.html#staking-and-registering" class="sidebar-link">Staking and Registering</a></li><li class="sidebar-sub-header"><a href="/operators/running-node-on-amber-network.html#you-re-a-validator" class="sidebar-link">You're a Validator!</a></li></ul></li><li><a href="/operators/creating-an-entity-package.html" class="sidebar-link">Creating an Entity Package</a></li><li><a href="/operators/migrating-questnet-entities.html" class="sidebar-link">Migrating Your QuestNet Entity for the Amber Network</a></li><li><a href="/operators/current-testnet-parameters.html" class="sidebar-link">Current Testnet Parameters</a></li><li><a href="/operators/stake-management.html" class="sidebar-link">Stake Management</a></li><li><a href="/operators/sentry-node.html" class="sidebar-link">Sentry Node Architecture</a></li><li><a href="/operators/incentives-proposal.html" class="sidebar-link">Network Incentives Proposal</a></li><li><a href="/operators/the-quest-rules.html" class="sidebar-link">The Quest Rules</a></li><li><a href="/operators/troubleshooting.html" class="sidebar-link">Troubleshooting Guide</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Maintenance Guides</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wallet Support</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/operators/community-resources.html" class="sidebar-link">Community Tools</a></li><li><a href="https://github.com/oasisprotocol/oasis-core/blob/master/docs/index.md" target="_blank" rel="noopener noreferrer" class="sidebar-link">Oasis Core Developer Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="running-a-node-on-the-amber-network"><a href="#running-a-node-on-the-amber-network" class="header-anchor">#</a> Running a Node on the Amber Network</h1> <p>This guide will cover setting up your node for the Amber Network, The Oasis
Amber Network is a release candidate for Mainnet and includes all the core
features of the network you can expect at Mainnet launch. For more details see
the <a href="/operators/amber-network.html">Amber Network</a> docs.</p> <p>This guide assumes some basic knowledge on the use of command line tools.</p> <div class="custom-block tip"><p class="custom-block-title">DISCLAIMER</p> <p>Participating as a node operator in the Amber Network requires AMBER test
tokens, which will be allocated to operators based on their winnings in The
Quest. Oasis will not be distributing AMBER test tokens to new node operators.
See the <a href="/operators/amber-network.html">Amber Network Rules</a> for other ways to participate.</p></div> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Before following this guide, make sure you've followed the <a href="/operators/prerequisites.html">Prerequisites
Guide</a> and understand how to use the <code>oasis-node</code> binary.</p> <h3 id="systems"><a href="#systems" class="header-anchor">#</a> Systems</h3> <p>This guide assumes that you have two different physical machines that you will
use for deployment. These machines are the following:</p> <ul><li>Your local system, henceforth called the <code>localhost</code>.</li> <li>A remote system to run as an Oasis node, henceforth called the <code>server</code>.</li></ul> <p>The reason for this is to ensure protection of the keys used to setup your
node. This guide does not include the use of HSMs, but they should be used in
the future.</p> <h2 id="creating-your-entity"><a href="#creating-your-entity" class="header-anchor">#</a> Creating Your Entity</h2> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Everything in this section should be done on the <code>localhost</code> as there are
sensitive items that will be created.</p></div> <h3 id="creating-a-working-directory"><a href="#creating-a-working-directory" class="header-anchor">#</a> Creating a Working Directory</h3> <p>During this entity initialization process, we will create keys and other
important artifacts that are necessary for the deployment of nodes on the
network. It is important that you save and protect the generated artifacts in
this directory if you intend to use them to register your entity and nodes.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>We will reference the working directory on <code>localhost</code> as <code>/localhostdir</code>
throughout the documentation.</p></div> <p>Inside <code>/localhostdir</code> you should create the following directories:</p> <ul><li><p><code>entity</code>: This will store your entity. The private contents in this directory
are safest if used on a machine kept disconnected from the internet.</p> <p>The directory's permissions should be <code>rwx------</code></p></li> <li><p><code>node</code>: This will store a node we are calling &quot;node&quot;. The name is not
important. It simply represents one of your nodes. You can rename it to
whatever you wish. The private contents of this directory will be used on the
node itself.</p> <p>You should initialize this information on a system with access to the entity's
private key.</p> <p>The directory permissions should be <code>rwx------</code></p></li></ul> <p>To create the directory structure, use the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -m700 -p <span class="token punctuation">{</span>entity,node<span class="token punctuation">}</span>
</code></pre></div><h3 id="copying-the-genesis-file"><a href="#copying-the-genesis-file" class="header-anchor">#</a> Copying the Genesis File</h3> <p>The latest genesis file can be found in <a href="/operators/current-testnet-parameters.html">Current Testnet Parameters</a>.
You should download the latest <code>genesis.json</code> file, copy it to the working
directory and set the following environment variable pointing to its path:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">GENESIS_FILE_PATH</span><span class="token operator">=</span>/localhostdir/genesis.json
</code></pre></div><p>This will be needed later when generating transactions.</p> <h3 id="initializing-an-entity"><a href="#initializing-an-entity" class="header-anchor">#</a> Initializing an Entity</h3> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If you previously created an entity for The Quest, you need to upgrade that
entity for the Amber Network. <a href="/operators/migrating-questnet-entities.html">Find the instructions
here</a>.</p></div> <p>As described in the <a href="/operators/architecture-overview.html#entities-and-key-management">Architecture Overview</a>, an entity is critical
to operating nodes on the network as it controls the stake attached to a given
individual or organization on the network. Once support is available, we suggest
that you use an HSM or Ledger device to protect your entity private key.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>We strongly suggest that you do not use any entity that is generated with the
current process on the Mainnet.</p> <p>We would also suggest that you generate the entity on a system that has no
network connection to provide rudimentary protection for the entity key.
However, it is up to you to determine your own security practices.</p></div> <p>To initialize an entity simply run the following from <code>/localhostdir/entity</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry entity init
</code></pre></div><p>This will generate three files in <code>/localhostdir/entity</code>:</p> <ul><li><code>entity.pem</code>: The private key of the entity. <strong>NEVER SHARE THIS AS IT CAN BE
USED TO TRANSFER STAKE</strong>.</li> <li><code>entity.json</code>: The entity descriptor. This is the JSON of the unsigned
information to be sent to the registry application on the network.</li> <li><code>entity_genesis.json</code>: This JSON object contains the entity descriptor that
has been signed with entity's private key, i.e. <code>entity.pem</code>.
This is meant to be shared for inclusion in the Genesis block.</li></ul> <h3 id="initializing-a-node"><a href="#initializing-a-node" class="header-anchor">#</a> Initializing a Node</h3> <p>A node registers itself to the network when the node starts up. However, in
order to validate itself, the entity signs a public key associated with the
node. This allows the node registration to happen without the uploading
entity's private key to the internet.</p> <p>To initialize a validator node, take note of the static IP of the
server where your node will run, and issue the following commands from the
<code>/localhostdir/node</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">STATIC_IP</span><span class="token operator">=</span><span class="token operator">&lt;</span>YOUR-STATIC-IP<span class="token operator">&gt;</span>
oasis-node registry node init <span class="token punctuation">\</span>
  --signer.backend <span class="token function">file</span> <span class="token punctuation">\</span>
  --signer.dir /localhostdir/entity <span class="token punctuation">\</span>
  --node.consensus_address <span class="token variable">$STATIC_IP</span>:26656 <span class="token punctuation">\</span>
  --node.is_self_signed <span class="token punctuation">\</span>
  --node.role validator
</code></pre></div><p>This command will create a validator node's identity so that it can be a
self-signed node (this is what allows self-registration).</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>There are more options for node initialization that you can explore by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry node init --help
</code></pre></div><p>The options shown above are just the minimum.</p></div> <p>The command will generate the following files:</p> <ul><li><code>consensus.pem</code>: The node's consensus private key. <strong>DO NOT SHARE</strong></li> <li><code>consensus_pub.pem</code>: The node's consensus public key.</li> <li><code>identity.pem</code>: The node's identity private key. <strong>DO NOT SHARE</strong></li> <li><code>identity_pub.pem</code>: The node's identity public key.</li> <li><code>node_genesis.json</code>: The node's details if you wish to include this node in
the genesis file of the network.</li> <li><code>p2p.pem</code>: The node's private key for libp2p. <strong>DO NOT SHARE</strong></li> <li><code>p2p_pub.pem</code>: The node's public key for libp2p.</li> <li><code>sentry_client_tls_identity.pem</code>: The node's TLS private key for
communicating with sentry nodes. <strong>DO NOT SHARE</strong></li> <li><code>sentry_client_tls_identity_cert.pem</code>: The node's TLS certificate for
communicating with sentry nodes.</li></ul> <h4 id="adding-the-node-to-the-entity-descriptor"><a href="#adding-the-node-to-the-entity-descriptor" class="header-anchor">#</a> Adding the Node to the Entity Descriptor</h4> <p>Once the node has been initialized, we need to add it to the entity descriptor
so that it can properly register itself when the node starts up.</p> <p>Execute the following command in the <code>/localhostdir/node</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry entity update <span class="token punctuation">\</span>
  --signer.dir /localhostdir/entity <span class="token punctuation">\</span>
  --entity.node.descriptor node_genesis.json
</code></pre></div><p>This will update the entity descriptor in <code>entity.json</code> and subsequently the
<code>entity_genesis.json</code> file that contains the signed entity descriptor payload.</p> <h2 id="running-an-oasis-node-on-the-server"><a href="#running-an-oasis-node-on-the-server" class="header-anchor">#</a> Running an Oasis Node on the <code>server</code></h2> <h3 id="setting-up-the-oasis-node-s-working-directory"><a href="#setting-up-the-oasis-node-s-working-directory" class="header-anchor">#</a> Setting up the Oasis Node's Working Directory</h3> <p>Before we run the node on the <code>server</code> we need to ensure that we have a place
to store necessary files for the node.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>We will reference the working directory on the <code>server</code> as <code>/serverdir</code>
throughout the documentation.</p></div> <h4 id="setting-up-the-the-serverdir-directory"><a href="#setting-up-the-the-serverdir-directory" class="header-anchor">#</a> Setting up the the <code>/serverdir</code> Directory</h4> <p>In the <code>/serverdir</code> directory we will create the following subdirectories:</p> <ul><li><code>etc/</code> - this is to store the configuration</li> <li><code>node/</code> - this is to store the node's data</li> <li><code>node/entity/</code> - this is to store the public components of the node's entity</li></ul> <p>You can make this directory structure by executing the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -m700 -p /serverdir/<span class="token punctuation">{</span>etc,node,node/entity<span class="token punctuation">}</span>
</code></pre></div><h4 id="copying-the-node-artifacts-from-localhostdir"><a href="#copying-the-node-artifacts-from-localhostdir" class="header-anchor">#</a> Copying the Node Artifacts from <code>/localhostdir</code></h4> <p>In order for the node registration to work properly, as defined in
<code>/localhostdir/entity.json</code>, you must copy the node's artifacts you generated
in the <a href="#initializing-a-node">Initializing a Node</a> section.
To do so, upload the following files from <code>/localhostdir/node</code> to
<code>/serverdir/node</code> over a secure channel (e.g. SSH):</p> <ul><li><code>consensus.pem</code></li> <li><code>consensus_pub.pem</code></li> <li><code>identity.pem</code></li> <li><code>identity_pub.pem</code></li> <li><code>p2p.pem</code></li> <li><code>p2p_pub.pem</code></li> <li><code>sentry_client_tls_identity.pem</code></li> <li><code>sentry_client_tls_identity_cert.pem</code></li></ul> <p>After copying, make sure that all these files have <code>0600</code> permissions, i.e.
only their owner has <code>read</code> and <code>write</code> permissions.</p> <p>To do so, run the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> -R <span class="token number">600</span> /serverdir/node/*.pem
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">IMPORTANT</p> <p>You may have noticed that some of these files were listed as <strong>DO NOT SHARE</strong>
in the <a href="#initializing-a-node">Initializing a Node</a> section.</p> <p>In the future, these keys should be generated and referenced from an HSM.
However, until HSM support is implemented, these keys should be kept as secure
as possible on the <code>server</code>.</p></div> <h4 id="copying-the-public-entity-artifacts-from-localhostdir"><a href="#copying-the-public-entity-artifacts-from-localhostdir" class="header-anchor">#</a> Copying the Public Entity Artifacts from <code>/localhostdir</code></h4> <p>We will also need to have the public entity artifacts from the <code>/localhostdir</code>
present on the <code>server</code>.
Copy the <code>/localhostdir/entity/entity.json</code> file on <code>localhost</code> to
<code>/serverdir/node/entity/entity.json</code> on the <code>server</code>.</p> <h4 id="copying-the-genesis-file-to-the-server"><a href="#copying-the-genesis-file-to-the-server" class="header-anchor">#</a> Copying the Genesis File to the server</h4> <p>The latest Genesis file can be found in the <a href="/operators/current-testnet-parameters.html">Current Testnet Parameters</a>.
You should download the latest <code>genesis.json</code> file and copy it to
<code>/serverdir/etc/genesis.json</code> on the <code>server</code>.</p> <h4 id="configuring-the-oasis-node"><a href="#configuring-the-oasis-node" class="header-anchor">#</a> Configuring the Oasis Node</h4> <p>There are a variety of options available when running an Oasis node. The
following YAML file is a basic configuration for a validator node on the
network.</p> <p>Before using this configuration you should collect the following information to
replace the <code>{{ var_name }}</code> variables present in the
configuration file:</p> <ul><li><p><code>{{ external_address }}</code>: The external IP you used when
registering this node.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If you are using a <a href="/operators/sentry-node.html">Sentry Node</a>, you should use the public IP of that
machine.</p></div></li> <li><p><code>{{ seed_node_address }}</code>:  The seed node address in the
form <code>ID@IP:port</code>.</p> <p>You can find the current Oasis Seed Node address in the <a href="/operators/current-testnet-parameters.html">Current Testnet
Parameters</a>.</p></li></ul> <p>To use this configuration, save it in the <code>/serverdir/etc/config.yml</code> file and
pass it to the <code>oasis-node</code> command as an argument to the <code>--config</code> flag.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">##</span>
<span class="token comment"># Oasis Node Configuration</span>
<span class="token comment">#</span>
<span class="token comment"># This file's contents are derived from the command line arguments found in the</span>
<span class="token comment"># root command of the oasis-node binary. For more information, execute:</span>
<span class="token comment">#</span>
<span class="token comment">#     oasis-node --help</span>
<span class="token comment">#</span>
<span class="token comment"># Settings on the command line that are separated by a dot all belong to the</span>
<span class="token comment"># same nested object. For example, &quot;--foo.bar.baz hello&quot; would translate to:</span>
<span class="token comment">#</span>
<span class="token comment">#     foo:</span>
<span class="token comment">#       bar:</span>
<span class="token comment">#         baz: hello</span>
<span class="token comment">##</span>

<span class="token comment"># Set this to where you wish to store node data. The node's artifacts</span>
<span class="token comment"># should also be located in this directory.</span>
<span class="token key atrule">datadir</span><span class="token punctuation">:</span> /serverdir/node

<span class="token comment"># Logging.</span>
<span class="token comment">#</span>
<span class="token comment"># Per-module log levels are defined below. If you prefer just one unified log</span>
<span class="token comment"># level, you can use:</span>
<span class="token comment">#</span>
<span class="token comment"># log:</span>
<span class="token comment">#   level: debug</span>
<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token comment"># Per-module log levels. Longest prefix match will be taken. Fallback to</span>
    <span class="token comment"># &quot;default&quot;, if no match.</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">tendermint</span><span class="token punctuation">:</span> warn
    <span class="token key atrule">tendermint/context</span><span class="token punctuation">:</span> error
  <span class="token key atrule">format</span><span class="token punctuation">:</span> JSON
  <span class="token comment"># By default logs are output to stdout. If you would like to output logs to</span>
  <span class="token comment"># a file, you can use:</span>
  <span class="token comment">#</span>
  <span class="token comment"># file: /var/log/oasis-node.log</span>

<span class="token comment"># Genesis.</span>
<span class="token key atrule">genesis</span><span class="token punctuation">:</span>
  <span class="token comment"># Path to the genesis file for the current version of the network.</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span> /serverdir/etc/genesis.json

<span class="token comment"># Worker configuration.</span>
<span class="token key atrule">worker</span><span class="token punctuation">:</span>
  <span class="token key atrule">registration</span><span class="token punctuation">:</span>
    <span class="token comment"># In order for the node to register itself, the entity.json of the entity</span>
    <span class="token comment"># used to provision the node must be available on the node.</span>
    <span class="token key atrule">entity</span><span class="token punctuation">:</span> /serverdir/node/entity/entity.json

<span class="token comment"># Consensus backend.</span>
<span class="token key atrule">consensus</span><span class="token punctuation">:</span>
  <span class="token comment"># Setting this to true will mean that the node you're deploying will attempt</span>
  <span class="token comment"># to register as a validator.</span>
  <span class="token key atrule">validator</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># Tendermint backend configuration.</span>
<span class="token key atrule">tendermint</span><span class="token punctuation">:</span>
  <span class="token key atrule">abci</span><span class="token punctuation">:</span>
    <span class="token key atrule">prune</span><span class="token punctuation">:</span>
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span> keep_n
      <span class="token comment"># Keep ~7 days of data since block production is ~1 block every 6 seconds.</span>
      <span class="token comment"># (7*24*3600/6 = 100800)</span>
      <span class="token key atrule">num_kept</span><span class="token punctuation">:</span> <span class="token number">100800</span>
  <span class="token key atrule">core</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen_address</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">26656</span>

    <span class="token comment"># The external IP that is used when registering this node to the network.</span>
    <span class="token comment"># NOTE: If you are using the Sentry node setup, this option should be</span>
    <span class="token comment"># omitted.</span>
    <span class="token key atrule">external_address</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//<span class="token punctuation">{</span><span class="token punctuation">{</span> external_address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">:</span><span class="token number">26656</span>

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">backend</span><span class="token punctuation">:</span> badger

  <span class="token comment"># List of seed nodes to connect to.</span>
  <span class="token comment"># NOTE: You can add additional seed nodes to this list if you want.</span>
  <span class="token key atrule">p2p</span><span class="token punctuation">:</span>
    <span class="token key atrule">seed</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;{{ seed_node_address }}&quot;</span>
</code></pre></div><h4 id="ensuring-proper-permissions"><a href="#ensuring-proper-permissions" class="header-anchor">#</a> Ensuring Proper Permissions</h4> <p>Only the owner of the process that runs the Oasis node should have access to
the files in the <code>/serverdir/node</code> directory.
The <code>oasis-node</code> binary ensures that the files used by the node are as least
privileged as possible so that you don't accidentally shoot yourself in the
foot while operating a node.</p> <p>To ensure proper permissions are set, we suggest running the following to
remove all non-owner read/write/execute permissions:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> -R go-r,go-w,go-x /serverdir
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Just so it's clear, the following permissions are expected by the <code>oasis-node</code>
binary:</p> <ul><li><code>700</code> for the <code>/serverdir/node</code> directory</li> <li><code>700</code> for the <code>/serverdir/node/entity</code> directory</li> <li><code>600</code> for all <code>*.pem</code> files</li></ul></div> <h3 id="starting-the-oasis-node"><a href="#starting-the-oasis-node" class="header-anchor">#</a> Starting the Oasis Node</h3> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>In a previous version of docs, we asked you to open port <code>42261</code> on a running
Docker container. In some configurations we noticed that this port was being
exposed to the outside world. This is no longer needed and should be removed
immediately. Keeping that port open was a temporary measure and is unsafe
generally. Please close that port to the public and do not bind to it in any
way.</p></div> <p>You can start the node by running the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node --config /serverdir/etc/config.yml
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The Oasis node is configured to run in the foreground by default.</p> <p>We recommend you configure and use it with a process manager like <a href="https://github.com/systemd/systemd" target="_blank" rel="noopener noreferrer">systemd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or <a href="http://supervisord.org/" target="_blank" rel="noopener noreferrer">Supervisor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <h3 id="verifying-the-connection-to-the-network"><a href="#verifying-the-connection-to-the-network" class="header-anchor">#</a> Verifying the Connection to the Network</h3> <p>As part of the starting the server process, the <code>oasis-node</code> binary will, by
default, setup an internal unix socket in the <code>datadir</code> of the Node. This socket
can be used to communicate to the node and query details about the network.</p> <p>Run the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry entity list -a unix:/serverdir/node/internal.sock
</code></pre></div><p>If this command fails, you'll receive a non-zero exit code and there's a high
likelihood that you are not connected to the network. However, if it does work
properly it should respond with output like the following but with potentially
many more values:</p> <div class="language-text extra-class"><pre class="language-text"><code>CVzqFIADD2Ed0khGBNf4Rvh7vSNtrL1ULTkWYQszDpc=
C5z1jB+FHB/QgtTITr6NKWpUs9QHwD11CG3v8tmuJ0g=
DPbZomOIleFrvcJBZPl7y/wEB1w9Q569vAbb6Krl9fE=
DVobZ8bWlOv2J6oHO0uITr5FPO5rIY2irdPNhByprHk=
D2hqhJcmZnBmhw9TodOdoFPAjmRkpRatANCNHxIDHgA=
</code></pre></div><p>Once you get to a node that's connected you can move on to the next section as
your node is not yet registered as a validator on the Oasis Testnet.</p> <h2 id="staking-and-registering"><a href="#staking-and-registering" class="header-anchor">#</a> Staking and Registering</h2> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>This step is not necessary if your entity was fully staked at genesis.</p></div> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>If you've submitted staking or registry transactions before, your nonce is
likely different than the nonce used in the examples. If you're uncertain,
please check your account nonce by using <a href="/operators/maintenance/checking-account-nonce.html">this guide</a>.</p></div> <p>Once you have been funded, you can complete the process of connecting your
node to the network by registering both your entity and your node, as
described below.</p> <h3 id="check-that-your-node-is-synced"><a href="#check-that-your-node-is-synced" class="header-anchor">#</a> Check that your node is synced</h3> <p>Before you can make any transactions you'll have to make sure that your node is
synced. To do so call this command on the server:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node control is-synced -a unix:/serverdir/node/internal.sock
</code></pre></div><p>If your node is synced, the above command should output:</p> <div class="language-text extra-class"><pre class="language-text"><code>node completed initial syncing
</code></pre></div><p>If your node is not yet synced, you will need to wait before you can move
forward.</p> <h3 id="generating-a-staking-escrow-transaction-on-the-localhost"><a href="#generating-a-staking-escrow-transaction-on-the-localhost" class="header-anchor">#</a> Generating a Staking (Escrow) Transaction on the <code>localhost</code></h3> <p>Your entity's private key should be disconnected from the internet on the
<code>localhost</code>. Therefore, you need to generate the following transaction on the
<code>localhost</code>.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>The entity's private key is used to authorize transactions on your staking
account.</p> <p>Hence it should never be present on the online <code>server</code>.</p></div> <p>The current minimum stake required to register an entity and
register a node as a validator is 200 tokens.
So, we will generate an escrow transaction that escrows 200 tokens on your own
entity.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The Oasis node's staking application calls the operation of staking tokens &quot;escrow.&quot;</p></div> <p>Before generating the escrow transaction, you need to set the following
environment variables:</p> <ul><li><p><code>GENESIS_FILE_PATH</code>: Path to the Genesis file on the <code>localhost</code>, i.e.
<code>/localhostdir/genesis.json</code>.</p></li> <li><p><code>ENTITY_DIR_PATH</code>: Path to entity's artifacts directory on the <code>localhost</code>,
i.e. <code>/localhostdir/entity/</code>.</p></li> <li><p><code>OUTPUT_TX_FILE_PATH</code>: Path to the file containing the outputted signed
transaction.</p> <p>For this guide, we will use <code>/localhostdir/signed-escrow.tx</code>.</p></li> <li><p><code>ACCOUNT_ADDRESS</code>: Your staking account address.</p> <p>To obtain your staking account address from your Entity's ID, see
<a href="/operators/stake-management.html#obtaining-account-address-from-entity-s-id">Obtaining account address from entity's ID</a>.</p></li></ul> <p>Then execute the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node stake account gen_escrow <span class="token punctuation">\</span>
  --genesis.file <span class="token variable">$GENESIS_FILE_PATH</span> <span class="token punctuation">\</span>
  --signer.backend <span class="token function">file</span> <span class="token punctuation">\</span>
  --signer.dir <span class="token variable">$ENTITY_DIR_PATH</span> <span class="token punctuation">\</span>
  --stake.escrow.account <span class="token variable">$ACCOUNT_ADDRESS</span> <span class="token punctuation">\</span>
  --stake.amount <span class="token number">200000000000</span> <span class="token punctuation">\</span>
  --transaction.file <span class="token variable">$OUTPUT_TX_FILE_PATH</span> <span class="token punctuation">\</span>
  --transaction.fee.gas <span class="token number">2269</span> <span class="token punctuation">\</span>
  --transaction.fee.amount <span class="token number">2000</span> <span class="token punctuation">\</span>
  --transaction.nonce <span class="token number">0</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The option <code>--stake.amount</code> looks like a very large number, but this is
actually just an equivalent to 200 tokens on the Amber Network as each unit
value used to track the account balance is 1x10^-9 tokens.</p> <p>The <code>--transactions.fee.gas</code> and <code>--transaction.fee.amount</code> options depend on
the network configuration, see <a href="/operators/stake-management.html#obtaining-transactions-gas-costs">Stake Management</a> for details.</p></div> <h3 id="generating-entity-registration-transaction"><a href="#generating-entity-registration-transaction" class="header-anchor">#</a> Generating Entity Registration Transaction</h3> <p>After you submit your escrow account, you'll need to register your entity so
that your node registers properly. You could do this process <em>after</em> you
submit the escrow transaction, however, to save steps we prepare everything
before hand.</p> <p>Before generating the register transaction, you need to set the following
environment variables:</p> <ul><li><p><code>GENESIS_FILE_PATH</code>: Path to the Genesis file on the <code>localhost</code>, i.e.
<code>/localhostdir/genesis.json</code>.</p></li> <li><p><code>ENTITY_DIR_PATH</code>: Path to entity's artifacts directory on the <code>localhost</code>,
i.e. <code>/localhostdir/entity/</code>.</p></li> <li><p><code>OUTPUT_REGISTER_TX_FILE_PATH</code>: Path to the file containing the outputted
signed transaction.</p> <p>For this guide, we will use <code>/localhostdir/signed-register.tx</code>.</p></li></ul> <p>Then execute the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry entity gen_register <span class="token punctuation">\</span>
  --genesis.file <span class="token variable">$GENESIS_FILE_PATH</span> <span class="token punctuation">\</span>
  --signer.backend <span class="token function">file</span> <span class="token punctuation">\</span>
  --signer.dir <span class="token variable">$ENTITY_DIR_PATH</span> <span class="token punctuation">\</span>
  --transaction.file <span class="token variable">$OUTPUT_REGISTER_TX_FILE_PATH</span> <span class="token punctuation">\</span>
  --transaction.fee.gas <span class="token number">2460</span> <span class="token punctuation">\</span>
  --transaction.fee.amount <span class="token number">1000</span> <span class="token punctuation">\</span>
  --transaction.nonce <span class="token number">1</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The <code>--transactions.fee.gas</code> and <code>--transaction.fee.amount</code> options depend on
the network configuration, see <a href="/operators/stake-management.html#obtaining-transactions-gas-costs">Stake Management</a> for details.</p></div> <h3 id="submitting-your-transactions-on-the-server"><a href="#submitting-your-transactions-on-the-server" class="header-anchor">#</a> Submitting Your Transactions on the <code>server</code></h3> <p>To complete the staking process we need to copy the generated escrow and
registry transactions from your offline <code>localhost</code> to the <code>server</code> and submit
them.</p> <p>To do so, follow these steps:</p> <ol><li>Copy the file <code>/localhostdir/signed-escrow.tx</code> on the <code>localhost</code> to
<code>/serverdir/signed-escrow.tx</code> on the <code>server</code>.</li> <li>Copy the file <code>/localhostdir/signed-register.tx</code> on the <code>localhost</code> to
<code>/serverdir/signed-register.tx</code> on the <code>server</code>.</li> <li>Submit both transactions via <code>oasis-node consensus submit_tx</code> sub-command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node consensus submit_tx <span class="token punctuation">\</span>
  --transaction.file /serverdir/signed-escrow.tx <span class="token punctuation">\</span>
  -a unix:/serverdir/node/internal.sock
oasis-node consensus submit_tx <span class="token punctuation">\</span>
  --transaction.file /serverdir/signed-register.tx <span class="token punctuation">\</span>
  -a unix:/serverdir/node/internal.sock
</code></pre></div><h3 id="checking-that-your-node-is-properly-registered"><a href="#checking-that-your-node-is-properly-registered" class="header-anchor">#</a> Checking that Your Node is Properly Registered</h3> <p>To ensure that your node is properly connected as a validator on the network,
you can run the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>oasis-node registry node is-registered -a unix:/serverdir/node/internal.sock
</code></pre></div><p>If your node is registered, the above command should output:</p> <div class="language-text extra-class"><pre class="language-text"><code>node is registered
</code></pre></div> <h2 id="you-re-a-validator"><a href="#you-re-a-validator" class="header-anchor">#</a> You're a Validator!</h2> <p>If you've made it this far, you've properly connected your node to the network
and you're now a validator on the Amber Network.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/oasisprotocol/docs/edit/master/src/src/operators/running-node-on-amber-network.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/operators/hardware-recommendations.html" class="prev">
        Node Hardware Recommendations
      </a></span> <span class="next"><a href="/operators/creating-an-entity-package.html">
        Creating an Entity Package
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f38c0d12.js" defer></script><script src="/assets/js/2.6394bade.js" defer></script><script src="/assets/js/22.4a8751d6.js" defer></script>
  </body>
</html>
